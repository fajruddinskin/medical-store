<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Store - Lab Reports</title>

    <!-- Bootstrap & FontAwesome -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/medical-store.css}">
</head>

<body>

<!-- ================= HEADER (SAME AS INDEX) ================= -->
<header class="chatgpt-header">
    <div class="header-inner">
        <i class="fas fa-hospital-alt fa-3x"></i>

        <nav class="header-nav">
            <a href="/">Dashboard</a>
            <a href="/medicines">Medicines</a>
            <a href="/customers">Customers</a>
            <a href="/reports" class="active">Reports</a>
            <a href="/lab-test-registration">Lab Tests</a>
        </nav>

        <div class="header-actions">
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn-outline">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </form>
        </div>
    </div>
</header>

<!-- ================= MAIN SHELL ================= -->
<div class="shell">
    <main class="main">

        <div class="page-title">
            <i class="fas fa-vials me-2"></i> Lab Reports
        </div>

        <!-- ================= FILTER CARD ================= -->
        <section class="table-card mb-4">
            <h5 class="mb-3">
                <i class="fas fa-filter me-2"></i> Search & Filter
            </h5>

            <form id="filterForm">
                <div class="d-flex flex-wrap align-items-end gap-2">

                    <div class="flex-grow-1" style="min-width: 150px;">
                        <label class="fw-bold">Start Date</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>

                    <div class="flex-grow-1" style="min-width: 150px;">
                        <label class="fw-bold">End Date</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>

                    <div class="flex-grow-1" style="min-width: 150px;">
                        <label class="fw-bold">Filter by Weeks</label>
                        <select id="weeksFilter" class="form-select">
                            <option value="">Select</option>
                            <option value="1">Last 1 Week</option>
                            <option value="2">Last 2 Weeks</option>
                            <option value="4">Last 4 Weeks</option>
                            <option value="8">Last 8 Weeks</option>
                        </select>
                    </div>

                    <div class="flex-grow-1" style="min-width: 180px;">
                        <label class="fw-bold">Search by Test ID</label>
                        <input type="text" id="searchBox" class="form-control" placeholder="Enter ID and press Enter">
                    </div>

                    <div class="d-flex gap-2" style="margin-top: 30px;">
                        <button type="button" class="btn btn-primary" onclick="applyFilter()">
                            <i class="fas fa-search"></i> Apply
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearFilters()">
                            <i class="fas fa-eraser"></i> Clear
                        </button>
                        <button type="button" class="btn btn-success" onclick="updateContainer()">
                            <i class="fas fa-sync"></i> Update
                        </button>
                    </div>

                </div>
            </form>
        </section>


        <!-- ================= LAB TEST TABLE ================= -->
        <section id="labTestsTableContainer" class="table-card" style="display:none;">
            <h5 class="mb-3">
                <i class="fas fa-flask me-2"></i> Lab Tests Details
            </h5>

            <table class="table table-striped table-hover align-middle">
                <thead>
                <tr>
                    <th>Test ID</th>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Invoice No</th>
                </tr>
                </thead>
                <tbody id="labTestsTableBody"></tbody>
            </table>
        </section>

        <!-- ================= REPORT EDITOR ================= -->
        <section class="table-card mt-4">
            <h5 class="mb-3">
                <i class="fas fa-file-medical me-2"></i> Report Editor
            </h5>

            <form id="reportForm">
                <input type="hidden" id="selectedTestId">
                <input type="hidden" id="invoiceNo">

                <div class="mb-3">
                    <label class="fw-bold">Report Status</label>
                    <select id="statusDropdown" class="form-select">
                        <option value="IN_PROGRESS">In Progress</option>
                        <option value="PENDING">Pending</option>
                        <option value="DONE">Done</option>
                    </select>
                </div>

                <textarea id="editor"></textarea>

                <div class="mt-3">
                    <button type="button" class="btn btn-primary" onclick="saveReport()">
                        Save Report
                    </button>
                    <button type="button" class="btn btn-secondary ms-2" onclick="printReport()">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
            </form>
        </section>

        <div class="footer-note">
            Â© 2025 Medical Store Management
        </div>

    </main>
</div>

<!-- ========================= -->
<!-- Scripts -->
<!-- ========================= -->

<script th:src="@{/js/jquery-3.7.1.min.js}"></script>
<script th:src="@{/js/bootstrap.bundle.js}"></script>
<script src="/tinymce/tinymce.min.js"></script>
<script th:src="@{/js/lab-reports.js}"></script>

<script>
    // =========================
    // TinyMCE Configuration
    // =========================
    tinymce.init({
        selector: "#editor",
        license_key: "gpl",
        branding: false,

        skin_url: "/tinymce/skins/ui/oxide",
        content_css: "/tinymce/skins/content/default/content.min.css",

        plugins: "link table lists",
        toolbar: "bold italic underline | bullist numlist | link table"
    });
</script>

</body>
</html>
